<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.22">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>MP01: Netflix – Sam Katzap - Who Am I?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-fbf3368e9a39f98674df9137282eadca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6f7c197ed6a36c53ce5b7d921c455e96.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Sam Katzap - Who Am I?</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">MP01: Netflix</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
</div>
<section id="downloading-global-data" class="level1">
<h1>Downloading global data</h1>
<p>if(!file.exists(GLOBAL_TOP_10_FILENAME)){ download.file(“https://www.netflix.com/tudum/top10/data/all-weeks-global.tsv”, destfile=GLOBAL_TOP_10_FILENAME) }</p>
</section>
<section id="download-country-data-if-missing" class="level1">
<h1>Download country data if missing</h1>
<p>if(!file.exists(COUNTRY_TOP_10_FILENAME)){ download.file(“https://www.netflix.com/tudum/top10/data/all-weeks-countries.tsv”, destfile=COUNTRY_TOP_10_FILENAME) }</p>
</section>
<section id="read-the-data-into-r-treating-na-as-proper-na" class="level1">
<h1>Read the data into R, treating “N/A” as proper NA</h1>
<p>GLOBAL_TOP_10 &lt;- read_tsv(GLOBAL_TOP_10_FILENAME, na = “N/A”) COUNTRY_TOP_10 &lt;- read_tsv(COUNTRY_TOP_10_FILENAME, na = “N/A”)</p>
</section>
<section id="quick-checks" class="level1">
<h1>Quick checks</h1>
<p>glimpse(GLOBAL_TOP_10) glimpse(COUNTRY_TOP_10) print(COUNTRY_TOP_10_FILENAME)</p>
</section>
<section id="total-number-of-countries-netflix-operates-in" class="level1">
<h1>Total Number of Countries Netflix Operates in</h1>
<p>country_count &lt;- COUNTRY_TOP_10 |&gt; distinct(country_iso2) |&gt; nrow()</p>
</section>
<section id="which-non-english-language-film-has-spent-the-most-cumulative-weeks-in-the-global-top-10-how-many-weeks-did-it-spend" class="level1">
<h1>Which non-English-language film has spent the most cumulative weeks in the global top 10? How many weeks did it spend?</h1>
<p>##All Quiet on the Western Front. 23 Total Weeks!! non_english_film &lt;- GLOBAL_TOP_10 |&gt; filter(category == “Films (Non-English)”) |&gt; group_by(show_title) |&gt; summarise(total_weeks = max(cumulative_weeks_in_top_10, na.rm = TRUE)) |&gt; arrange(desc(total_weeks)) |&gt; slice(1)</p>
<p>#What is the longest film (English or non-English) to have ever appeared in the Netflix global Top 10? How long is it in minutes?</p>
<p>##Pushpa 2: The Rule (Reloaded Version) - 224 minutes longest_film &lt;- GLOBAL_TOP_10 |&gt; filter(str_detect(category, “Films”)) |&gt; filter(!is.na(runtime)) |&gt; mutate(runtime_minutes = round(60 * runtime)) |&gt; arrange(desc(runtime_minutes)) |&gt; slice(1) # For each of the four categories, what program has the most total hours of global viewership? top_programs_by_category &lt;- GLOBAL_TOP_10 |&gt; group_by(category, show_title) |&gt; summarise(total_hours = sum(weekly_hours_viewed, na.rm = TRUE), .groups = “drop”) |&gt; group_by(category) |&gt; slice_max(total_hours, n = 1) |&gt; arrange(desc(total_hours)) top_programs_by_category |&gt; mutate(total_hours = scales::comma(total_hours)) |&gt; select(category, show_title, total_hours) |&gt; format_titles() |&gt; datatable( options = list(searching = FALSE, info = FALSE), caption = “Top Programs by Category” ) #Which TV show had the longest run in a country’s Top 10? How long was this run and in what country did it occur? ##Money Heist - Pakistan - 127 Weeks longest_country_run &lt;- COUNTRY_TOP_10 |&gt; filter(str_detect(category, “TV”)) |&gt; group_by(country_name, show_title) |&gt; summarise(max_weeks = max(cumulative_weeks_in_top_10, na.rm = TRUE), .groups = “drop”) |&gt; arrange(desc(max_weeks)) |&gt; slice(1) # Netflix provides over 200 weeks of service history for all but one country in our data set. Which country is this and when did Netflix cease operations in that country? ## Russia in February 2022 library(lubridate) country_weeks &lt;- COUNTRY_TOP_10 |&gt; group_by(country_name) |&gt; summarise( weeks_count = n_distinct(week), last_week = max(week, na.rm = TRUE), .groups = “drop” ) |&gt; filter(weeks_count &lt; 200) |&gt; arrange(weeks_count) #What is the total viewership of the TV show Squid Game? ##5,310,000,000 hours squid_game_total &lt;- GLOBAL_TOP_10 |&gt; filter(str_detect(show_title, “Squid Game”)) |&gt; summarise(total_hours = sum(weekly_hours_viewed, na.rm = TRUE)) |&gt; pull(total_hours) #The movie Red Notice has a run-time of 1 hour and 58 minutes. Approximately how many views did it receive in 2021? ## 0 Views library(lubridate) red_notice_2021 &lt;- GLOBAL_TOP_10 |&gt; filter(show_title == “Red Notice”, year(week) == 2021) |&gt; summarise(total_views = sum(weekly_views, na.rm = TRUE)) |&gt; pull(total_views) #How many Films reached Number 1 in the US but did not originally debut there? What is the most recent film to pull this off? ## 45 total films - Kpop Demon Hunters? us_films_analysis &lt;- COUNTRY_TOP_10 %&gt;% filter(country_name == “United States”, grepl(“Films”, category)) %&gt;% group_by(show_title) %&gt;% arrange(week) %&gt;% mutate( ever_hit_1 = any(weekly_rank == 1), debut_rank = first(weekly_rank) ) %&gt;% filter(ever_hit_1 == TRUE, debut_rank &gt; 1) %&gt;% ungroup() %&gt;% distinct(show_title) %&gt;% nrow()</p>
<p>most_recent_film &lt;- COUNTRY_TOP_10 %&gt;% filter(country_name == “United States”, grepl(“Films”, category)) %&gt;% group_by(show_title) %&gt;% arrange(week) %&gt;% mutate( ever_hit_1 = any(weekly_rank == 1), debut_rank = first(weekly_rank), latest_week = max(week) ) %&gt;% filter(ever_hit_1 == TRUE, debut_rank &gt; 1) %&gt;% ungroup() %&gt;% arrange(desc(latest_week)) %&gt;% slice(1) # Which TV show/season hit the top 10 in the most countries in its debut week? In how many countries did it chart? ## Emily in Paris. 94 Countries. tv_debut_countries &lt;- COUNTRY_TOP_10 %&gt;% filter(grepl(“TV”, category)) %&gt;% group_by(show_title) %&gt;% filter(week == min(week)) %&gt;% summarise(countries_count = n_distinct(country_name), .groups = “drop”) %&gt;% arrange(desc(countries_count)) %&gt;% slice(1)</p>
<section id="stranger-things-season-5-coming-out-soon" class="level2">
<h2 class="anchored" data-anchor-id="stranger-things-season-5-coming-out-soon">Stranger Things Season 5 Coming Out Soon!</h2>
</section>
<section id="the-hawkins-fab-5-are-teaming-up-once-again-for-a-final-stand-against-the-upside-down.-the-netflix-hit-original-series-that-has-gathered-nearly-3-billion-viewing-hours-has-fans-re-binging-just-in-time-for-halloween-season-as-the-show-is-coming-back-for-its-5th-and-final-season.-being-in-the-global-top-10-for-19-consecutive-weeks-and-only-dominating-similarly-to-squid-games-stranger-things-has-continued-to-be-a-mainstay-in-the-top-charts-in-the-global-markets-and-this-final-season-should-be-a-very-successful-bow-on-what-has-been-a-tremendous-success-for-netflix." class="level2">
<h2 class="anchored" data-anchor-id="the-hawkins-fab-5-are-teaming-up-once-again-for-a-final-stand-against-the-upside-down.-the-netflix-hit-original-series-that-has-gathered-nearly-3-billion-viewing-hours-has-fans-re-binging-just-in-time-for-halloween-season-as-the-show-is-coming-back-for-its-5th-and-final-season.-being-in-the-global-top-10-for-19-consecutive-weeks-and-only-dominating-similarly-to-squid-games-stranger-things-has-continued-to-be-a-mainstay-in-the-top-charts-in-the-global-markets-and-this-final-season-should-be-a-very-successful-bow-on-what-has-been-a-tremendous-success-for-netflix.">The Hawkins fab 5 are teaming up once again for a final stand against the upside down. The Netflix hit original series that has gathered nearly 3 billion viewing hours has fans re-binging just in time for Halloween season as the show is coming back for its 5th and final season. Being in the global top 10 for 19 consecutive weeks and only dominating similarly to Squid Games, Stranger Things has continued to be a mainstay in the top charts in the global markets and this final season should be a very successful bow on what has been a tremendous success for Netflix.</h2>
</section>
</section>
<section id="analyze-stranger-things-most-recent-season-data" class="level1">
<h1>Analyze Stranger Things most recent season data</h1>
<p>stranger_things_data &lt;- GLOBAL_TOP_10 %&gt;% filter(grepl(“Stranger”, show_title)) %&gt;% arrange(desc(week)) %&gt;% slice_head(n = 50) %&gt;% summarise( total_viewing_hours = sum(weekly_hours_viewed, na.rm = TRUE), max_weeks = max(cumulative_weeks_in_top_10, na.rm = TRUE) )</p>
</section>
<section id="find-comparable-shows" class="level1">
<h1>Find comparable shows</h1>
<p>comparable_shows &lt;- GLOBAL_TOP_10 %&gt;% filter(category == “TV (English)”, !grepl(“Stranger”, show_title)) %&gt;% group_by(show_title) %&gt;% summarise(total_hours = sum(weekly_hours_viewed, na.rm = TRUE)) %&gt;% arrange(desc(total_hours)) %&gt;% slice(1:2) %&gt;% pull(show_title)</p>
<p>comparable_show_1 &lt;- comparable_shows[1] comparable_show_2 &lt;- comparable_shows[2] #India Continuing to Dominate on Netflix ##Netflix’s expansion in India stands out as a remarkable success. Over time, 1,168 unique titles have appeared in the country’s Top 10 charts, accounting for 4,420 weekly entries. Shows like The Great Indian Kapil Show became major hits locally, despite having little presence in U.S. rankings, highlighting the impact of content customized for specific languages and cultural tastes.</p>
<p>##Examining trends over time, Netflix’s content diversity in India has grown, with an average of 39 different programs appearing in the Top 10 each week. With an estimated 30–40 million subscribers based on engagement patterns, India ranks among Netflix’s largest and fastest-growing markets. Notably, 71 shows—including hits like Money Heist—remained in India’s Top 10 for over 10 weeks, demonstrating both the company’s expanding reach and the long-term potential of India as a key growth market. india_total_shows &lt;- COUNTRY_TOP_10 |&gt; filter(country_name == “India”) |&gt; distinct(show_title) |&gt; nrow()</p>
<p>india_total_weeks &lt;- COUNTRY_TOP_10 |&gt; filter(country_name == “India”) |&gt; nrow()</p>
<p>india_shows &lt;- COUNTRY_TOP_10 |&gt; filter(country_name == “India”) |&gt; group_by(show_title) |&gt; summarise(weeks = n(), .groups = “drop”) |&gt; arrange(desc(weeks))</p>
<p>us_shows &lt;- COUNTRY_TOP_10 |&gt; filter(country_name == “United States”) |&gt; distinct(show_title)</p>
<p>india_only &lt;- anti_join(india_shows, us_shows, by = “show_title”) popular_show_not_in_US &lt;- if(nrow(india_only) &gt; 0) { india_only$show_title[1] } else { “regional content” }</p>
<p>most_popular_india &lt;- india_shows |&gt; slice(1)</p>
<p>top_show_india &lt;- if(nrow(most_popular_india) &gt; 0) { most_popular_india$show_title } else { “top shows” }</p>
<p>long_running_shows &lt;- india_shows |&gt; filter(weeks &gt; 10) |&gt; nrow()</p>
<p>india_monthly &lt;- COUNTRY_TOP_10 |&gt; filter(country_name == “India”) |&gt; mutate(month = format(week, “%Y-%m”)) |&gt; group_by(month) |&gt; summarise(shows = n_distinct(show_title), .groups = “drop”) |&gt; arrange(month)</p>
<p>growth_trend &lt;- if(nrow(india_monthly) &gt; 1) { if(tail(india_monthly<span class="math inline">\(shows, 1) &gt; head(india_monthly\)</span>shows, 1)) “increased” else “remained stable” } else { “grown” }</p>
<p>avg_shows_per_week &lt;- round(mean(india_monthly$shows, na.rm = TRUE))</p>
<p>subscriber_estimate &lt;- “30-40 million”</p>
<p>#Massive Risks Created Massive Reward - 2022 - 2025 The Global Dominance of Netflix ##February 24, 2022, was a dark day in European history as Russia began deploying troops in Ukraine. Global outrage on Russia full scale war effort saw large efforts in international companies and committees no longer recognizing Russia. On February 27, 2022, Netflix was one of the companies that pulled the plug on subscribers being able to stream their favorite movies and TV shows. The immediate result, detrimental, Netflix reported poor quarterly earnings losing 200,000 subscribers when looking to gain an additional 2.5 million subscribers. This caused the share value of Netflix to plummet 45% in April and Netflix had to pivot, where to dominate next? Netflix then began investing in the Asian market, where over the span of 3 years has seen shows: Squid Games, Kpop Demon Hunters, RRR dominate. Squid Games has become the most viewed show in Netflix history and overall the Asian market has rebounded Netflix in its entirety, with overall share price increasing by over 600% since its Q1 report in 2022. With no signs of bringing services back to one of the platforms largest users, Netflix has reshaped its company to invest in new markets to gain incredible international success. library(lubridate) country_weeks &lt;- COUNTRY_TOP_10 |&gt; group_by(country_name) |&gt; summarise( weeks_count = n_distinct(week), last_week = max(week, na.rm = TRUE), .groups = “drop” ) |&gt; filter(weeks_count &lt; 200) |&gt; arrange(weeks_count) #What is the total viewership of the TV show Squid Game? ##5,310,000,000 hours squid_game_total &lt;- GLOBAL_TOP_10 |&gt; filter(str_detect(show_title, “Squid Game”)) |&gt; summarise(total_hours = sum(weekly_hours_viewed, na.rm = TRUE)) |&gt; pull(total_hours)</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/katzap1018\.github\.io\/STA9750-2025-FALL\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>